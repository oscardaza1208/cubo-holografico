<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Candado 3D • Anti‑Phishing (Optimizado Móvil)</title>

  <!-- A‑Frame: CDN principal -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <!-- Fallback si el CDN principal está bloqueado -->
  <script>
    if (!window.AFRAME) {
      var s=document.createElement('script');
      s.src='https://unpkg.com/aframe@1.5.0/dist/aframe.min.js';
      document.head.appendChild(s);
    }
  </script>

  <style>
    :root {
      --padTop: max(8px, env(safe-area-inset-top));
      --padBottom: max(12px, env(safe-area-inset-bottom));
    }
    html,body { height:100%; margin:0; background:#0b0f14; }
    /* Tarjeta inferior (no se cruza con el candado) */
    .banner-bottom{
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: calc(8px + var(--padBottom)); z-index: 10;
      width: min(960px, 92vw);
      background: linear-gradient(135deg, #fff8e1 0%, #ffeaa7 100%);
      color: #263238; padding: 12px 16px; border-radius: 16px;
      box-shadow: 0 14px 32px rgba(0,0,0,.35), 0 4px 10px rgba(0,0,0,.18);
      font: 500 15px/1.45 "Segoe UI", Roboto, system-ui, -apple-system, Arial, sans-serif;
      animation: pop-in .5s ease-out both, glow 2.4s ease-in-out infinite;
    }
    .b-title{ display:flex; align-items:center; gap:10px; font-weight:800; font-size:18px; margin-bottom:6px; }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      background:#e53935; color:#fff; padding:3px 10px; border-radius:999px;
      font-weight:800; font-size:12px; box-shadow: 0 2px 8px rgba(229,57,53,.45);
    }
    .tips{ margin:0; padding-left:18px; color:#37474f; }
    .tips li{ margin:3px 0; }
    @keyframes pop-in { from{ transform: translate(-50%, 8px) scale(.98); opacity:.0 } to{ transform: translate(-50%,0) scale(1); opacity:1 } }
    @keyframes glow { 0%,100%{ box-shadow: 0 14px 32px rgba(0,0,0,.35), 0 0 0 0 rgba(255,234,167,.0) } 50%{ box-shadow: 0 14px 32px rgba(0,0,0,.35), 0 0 28px 0 rgba(255,234,167,.55) } }
    /* El lienzo 3D ocupa toda la pantalla; la tarjeta queda por encima, abajo */
    a-scene{ position: fixed; inset: 0; }
  </style>
</head>
<body>

  <!-- ESCENA 3D (sin cámara, sin aro azul) -->
  <a-scene renderer="antialias:true; colorManagement:true" background="color: #0b0f14">
    <!-- Luces principales -->
    <a-entity light="type: ambient; color:#b0bec5; intensity:1.0"></a-entity>
    <a-entity light="type: directional; color:#ffffff; intensity:0.9" position="1 2 1"></a-entity>

    <!-- Luz que orbita (efecto dinámico sobre el candado) -->
    <a-entity id="orbital" position="0 1.35 -3" animation="property: rotation; to: 0 360 0; loop:true; dur: 5000; easing: linear">
      <a-entity light="type: point; color:#00e5ff; intensity:0.9; distance:4" position="1 0.3 0"></a-entity>
    </a-entity>

    <!-- ===== Candado 3D (sin base), centrado y más “wow” ===== -->
    <a-entity id="candado" position="0 1.35 -3" scale="1 1 1"
              animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 8500; easing: linear"
              animation__pulse="property: scale; dir: alternate; to: 1.07 1.07 1.07; dur: 1400; loop:true; easing: easeInOutSine">

      <!-- Arco metálico con brillo (emissive) -->
      <a-torus radius="0.45" radius-tubular="0.06" position="0 0.55 0"
               material="color:#cfd8dc; metalness:0.95; roughness:0.2; emissive:#59f1ff; emissiveIntensity:0.08"></a-torus>
      <!-- Soportes del arco -->
      <a-cylinder radius="0.12" height="0.20" position="-0.43 0.25 0"
                  material="color:#cfd8dc; metalness:0.95; roughness:0.25"></a-cylinder>
      <a-cylinder radius="0.12" height="0.20" position="0.43 0.25 0"
                  material="color:#cfd8dc; metalness:0.95; roughness:0.25"></a-cylinder>

      <!-- Cuerpo (estética tipo “cubo” icónico) -->
      <a-box width="1.2" height="1.1" depth="0.5" position="0 -0.2 0"
             material="color:#ffd54f; metalness:0.28; roughness:0.85"></a-box>

      <!-- Placa y ranura -->
      <a-box width="0.52" height="0.22" depth="0.04" position="0 -0.2 0.28"
             material="color:#5d4037; metalness:0.25; roughness:0.55"></a-box>
      <a-box width="0.08" height="0.04" depth="0.02" position="0 -0.2 0.30"
             material="color:#000000"></a-box>
    </a-entity>

    <!-- Partículas sutiles para “enganchar la vista” -->
    <a-entity id="sparks">
      <a-sphere radius="0.015" color="#82e9de" position="-0.5 0.6 -3"
                material="opacity:0.9" animation="property: position; to: -0.5 1.8 -3; dur: 2600; loop: true; easing: easeOutCubic"></a-sphere>
      <a-sphere radius="0.012" color="#90caf9" position="0.6 0.5 -3"
                material="opacity:0.8" animation="property: position; to: 0.6 1.7 -3; dur: 2300; loop: true; easing: easeOutCubic; delay: 400"></a-sphere>
      <a-sphere radius="0.01" color="#b388ff" position="0.1 0.7 -3"
                material="opacity:0.85" animation="property: position; to: 0.1 1.9 -3; dur: 2800; loop: true; easing: easeOutCubic; delay: 800"></a-sphere>
      <a-sphere radius="0.014" color="#80deea" position="-0.2 0.4 -3"
                material="opacity:0.85" animation="property: position; to: -0.2 1.6 -3; dur: 2400; loop: true; easing: easeOutCubic; delay: 1200"></a-sphere>
    </a-entity>

    <!-- Cámara fija (no requiere permisos) -->
    <a-entity position="0 1.6 0" camera look-controls="enabled:false"></a-entity>
  </a-scene>

  <!-- Tarjeta con mensaje (abajo, no tapa el candado) -->
  <div class="banner-bottom" role="region" aria-label="Consejos Anti‑Phishing">
    <div class="b-title"><span class="badge">⚠ PHISHING</span> <span>Protege tu información</span></div>
    <ul class="tips">
      <li><b>Verifica</b> remitente y <b>dominio</b> antes de responder.</li>
      <li><b>No</b> abras enlaces ni archivos sospechosos.</li>
      <li><b>Desconfía</b> de urgencias, premios o solicitudes inusuales.</li>
    </ul>
  </div>

  <!-- Interacciones táctiles: arrastrar (rotar) y pellizcar (zoom) -->
  <script>
    window.addEventListener('load', function(){
      var el = document.getElementById('candado');
      var obj = el.object3D;
      var sceneEl = document.querySelector('a-scene');

      function onCanvas(cb){
        if (sceneEl.renderer && sceneEl.canvas) return cb(sceneEl.canvas);
        sceneEl.addEventListener('render-target-loaded', ()=> cb(sceneEl.canvas));
      }

      onCanvas(function(canvas){
        var isDown=false, startX=0, startRotY=0;
        var pinch=false, startDist=0, startScale=1;
        var inertia=0, lastX=0, raf=null;

        function d(t){ var dx=t[0].clientX-t[1].clientX, dy=t[0].clientY-t[1].clientY; return Math.hypot(dx,dy); }
        function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }

        // Rotación por arrastre (1 dedo / mouse)
        canvas.addEventListener('pointerdown', e=>{
          isDown=true; pinch=false; startX=e.clientX; lastX=e.clientX; startRotY=obj.rotation.y;
          canvas.setPointerCapture(e.pointerId);
        });
        canvas.addEventListener('pointermove', e=>{
          if(!isDown || pinch) return;
          var dx = e.clientX - startX;
          obj.rotation.y = startRotY + dx * 0.01;
          inertia = (e.clientX - lastX) * 0.004;
          lastX = e.clientX;
        });
        canvas.addEventListener('pointerup', e=>{
          if(isDown){ isDown=false; canvas.releasePointerCapture(e.pointerId); }
        });

        // Inercia suave al soltar
        function tick(){
          if (Math.abs(inertia) > 0.0005) {
            obj.rotation.y += inertia;
            inertia *= 0.96;
            raf = requestAnimationFrame(tick);
          } else { cancelAnimationFrame(raf); raf=null; }
        }
        setInterval(()=>{ if(!raf && Math.abs(inertia)>0.0005) tick(); }, 60);

        // Pellizco (zoom 2 dedos)
        canvas.addEventListener('touchstart', e=>{
          if(e.touches.length===2){
            pinch=true; isDown=false; startDist = d(e.touches);
            var s = el.getAttribute('scale'); startScale = s.x;
          }
        }, {passive:true});
        canvas.addEventListener('touchmove', e=>{
          if(pinch && e.touches.length===2){
            var factor = d(e.touches)/startDist;
            var newS = clamp(startScale * factor, 0.75, 1.7);
            el.setAttribute('scale', {x:newS, y:newS, z:newS});
          }
        }, {passive:true});
        canvas.addEventListener('touchend', ()=>{ pinch=false; }, {passive:true});
      });
    });
  </script>

  <!-- Aviso si el visor 3D no cargó (por bloqueo CDN/caché) -->
  <script>
    setTimeout(()=>{
      if (!window.AFRAME || !document.querySelector('canvas')) {
        alert('No se pudo cargar el visor 3D. Recarga (Ctrl+F5) o abre en incógnito. En red corporativa, el CDN puede estar bloqueado.');
      }
    }, 2200);
  </script>
</body>
</html>
